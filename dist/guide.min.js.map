{"version":3,"sources":["webpack://Guide/./lib/guide.ts","webpack://Guide/./lib/index.default.ts","webpack://Guide/webpack/bootstrap","webpack://Guide/webpack/startup","webpack://Guide/webpack/runtime/define property getters","webpack://Guide/webpack/runtime/hasOwnProperty shorthand"],"names":["defaultOption","minGridLength","gridProvider","guide","index","gridSize","Math","pow","subgrids","theme","backgroundColor","gridColor","textColor","parent_","option","width","height","this","canvasEl_","document","createElement","ctx_","getContext","append","updateOption","layout","option_","width_","height_","start_","end_","update","setRange","start","end","findAppropriateGridSize","ret","lengthPerUnit","lo","hi","mid","floor","grid","fillStyle","fillRect","strokeStyle","units","lenPerUnit","startI","endI","ceil","posBase","save","translate","round","i","pos","beginPath","moveTo","lineTo","stroke","text","textProvider","met","measureText","textPos","fillText","j","subI","subPos","restore","__webpack_module_cache__","__webpack_require__","moduleId","exports","module","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call"],"mappings":"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","file":"guide.min.js","sourcesContent":["interface IGrid {\r\n  gridSize: number;\r\n  subgrids: number;\r\n}\r\n\r\nexport interface IGuideGridProvider {\r\n  (guide: Guide, index: number): IGrid;\r\n}\r\n\r\ninterface IIGuideOption {\r\n  minGridLength: number;\r\n  gridProvider: IGuideGridProvider;\r\n  textProvider?: (index: number) => string;\r\n  theme: IGuideTheme;\r\n}\r\n\r\nexport interface IGuideOption extends Partial<IIGuideOption> {}\r\n\r\nexport interface IGuideTheme {\r\n  backgroundColor: string;\r\n  gridColor: string;\r\n  textColor: string;\r\n}\r\n\r\nconst defaultTheme: IGuideTheme = {\r\n  backgroundColor: '#232323',\r\n  gridColor: '#4f4f4f',\r\n  textColor: '#a3a3a3',\r\n}\r\n\r\nconst defaultOption: IIGuideOption = {\r\n  minGridLength: 80,\r\n  gridProvider: (guide: Guide, index: number) => {\r\n    const baselines = [1, 2, 5, 10];\r\n    if (index >= 4) {\r\n      return {\r\n        gridSize: 30 * Math.pow(2, index - 4),\r\n        subgrids: 10\r\n      };\r\n    }\r\n    else {\r\n      return  {\r\n        gridSize: baselines[index],\r\n        subgrids: 10\r\n      }\r\n    }\r\n  },\r\n  theme: defaultTheme\r\n}\r\n\r\nexport class Guide {\r\n\r\n  private canvasEl_: HTMLCanvasElement;\r\n  private ctx_: CanvasRenderingContext2D;\r\n\r\n  private option_: IIGuideOption;\r\n  get option() { return this.option_; }\r\n\r\n  private width_: number;\r\n  get width() { return this.width_; }\r\n  private height_: number;\r\n  get height() { return this.height_; }\r\n\r\n  private start_: number;\r\n  get start() { return this.start_; }\r\n  private end_: number;\r\n  get end() { return this.end_; }\r\n\r\n  constructor(\r\n    private readonly parent_: HTMLElement,\r\n    option: IGuideOption,\r\n    width: number, height: number\r\n  ) {\r\n    this.canvasEl_ = document.createElement('canvas');\r\n    this.ctx_ = this.canvasEl_.getContext('2d');\r\n    this.parent_.append(this.canvasEl_);\r\n    this.updateOption({\r\n      ...defaultOption,\r\n      ...option\r\n    })\r\n    this.layout(width, height);\r\n  }\r\n\r\n  updateOption(option: IGuideOption) {\r\n    this.option_ = {\r\n      ...this.option_,\r\n      ...option\r\n    };\r\n    this.update();\r\n  }\r\n\r\n  layout(width: number, height: number) {\r\n    this.width_ = width;\r\n    this.height_ = height;\r\n    this.canvasEl_.width = width;\r\n    this.canvasEl_.height = height;\r\n\r\n    this.update();\r\n  }\r\n\r\n  setRange(start: number, end: number) {\r\n    this.start_ = start;\r\n    this.end_ = end;\r\n    this.update();\r\n  }\r\n\r\n  private findAppropriateGridSize(): IGrid {\r\n    const minGridLength = this.option_.minGridLength;\r\n    const lengthPerUnit = this.width / (this.end - this.start);\r\n    let lo = 0;\r\n    let hi = 10000000;\r\n    let ret: IGrid;\r\n    while (lo <= hi) {\r\n      const mid = Math.floor((lo + hi) / 2);\r\n      const grid = this.option_.gridProvider(this, mid);\r\n      const gridLength = grid.gridSize * lengthPerUnit;\r\n      if (gridLength < minGridLength) {\r\n        lo = mid + 1;\r\n      }\r\n      else {\r\n        ret = grid;\r\n        hi = mid - 1;\r\n      }\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  private update() {\r\n    this.ctx_.fillStyle = this.option_.theme.backgroundColor;\r\n    this.ctx_.fillRect(0, 0, this.width, this.height);\r\n    this.ctx_.strokeStyle = this.option_.theme.gridColor;\r\n    const grid = this.findAppropriateGridSize();\r\n    const units = this.end - this.start;\r\n    const lenPerUnit = this.width / units;\r\n    const startI = Math.floor(this.start / grid.gridSize) * grid.gridSize;\r\n    const endI = Math.ceil(this.end / grid.gridSize) * grid.gridSize;\r\n    const posBase = (lenPerUnit * this.start);\r\n    this.ctx_.save();\r\n    this.ctx_.translate(Math.round(-posBase), 0);\r\n    this.ctx_.translate(0.5, 0.5);\r\n    for (let i = startI; i < endI; i += grid.gridSize) {\r\n      const pos = Math.floor(lenPerUnit * i);\r\n      this.ctx_.beginPath();\r\n      this.ctx_.moveTo(pos, this.height);\r\n      this.ctx_.lineTo(pos, 15);\r\n      this.ctx_.stroke();\r\n      const text = this.option_.textProvider && this.option_.textProvider(i);\r\n      if (text) {\r\n        const met = this.ctx_.measureText(text);\r\n        const textPos = Math.floor(pos - met.width / 2);\r\n        this.ctx_.fillStyle = this.option_.theme.textColor;\r\n        this.ctx_.fillText(text, textPos, 10);\r\n      }\r\n      for (let j = 1; j < grid.subgrids; j ++) {\r\n        const subI = i + grid.gridSize / grid.subgrids * j;\r\n        const subPos = Math.floor(lenPerUnit * subI);\r\n        this.ctx_.beginPath();\r\n        this.ctx_.moveTo(subPos, this.height);\r\n        this.ctx_.lineTo(subPos, 20);\r\n        this.ctx_.stroke();\r\n      }\r\n    }\r\n    this.ctx_.restore();\r\n  }\r\n  \r\n}","import { Guide } from './guide';\r\n\r\nexport default Guide;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(655);\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)"],"sourceRoot":""}